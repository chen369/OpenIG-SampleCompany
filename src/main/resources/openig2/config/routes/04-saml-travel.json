{
  "baseURI": "http://travel.sample.com:8012",
  "handler": {
    "type": "DispatchHandler",
    "config": {
      "bindings": [
        {
          "comment": "SAML federation handler for /saml",
          "name": "SamlFederationHandler",
          "condition": "${matches(request.uri.path, '^/saml')}",
          "handler": {
            "type": "SamlFederationHandler",
            "config": {
              "assertionMapping": {
                "uid": "uid",
                "mail": "mail"
              },
              "subjectMapping": "subjectName",
              "redirectURI": "http://travel-ig.sample.com:9002/travelApp"
            },
            "capture": "all"
          }
        },
        {
          "comment": "SP init SSO in case user is not authenticated",
          "name": "StaticResponseHandler",
          "condition": "${empty session.mail and not matches(request.uri.path, '^/saml')}",
          "handler": {
            "type": "StaticResponseHandler",
            "config": {
              "status": 302,
              "reason": "Found",
              "headers": {
                "Location": [
                  "http://travel-ig.sample.com:9002/saml/SPInitiatedSSO?RelayState=${urlEncode(contexts.router.originalUri)}"
                ]
              }
            },
            "capture": "all"
          }
        },
        {
          "comment": "Chain to set HTTP headers/ cookies required by SP",
          "name": "SP Chain",
          "condition": "${not empty session.mail}",
          "handler": {
            "type": "Chain",
            "config": {
              "filters": [
                {
                  "comment": "Set HTTP headers",
                  "name": "HeaderFilter",
                  "comment": "Set HTTP headers",
                  "name": "Application Headers",
                  "type": "HeaderFilter",
                  "config": {
                    "messageType": "REQUEST",
                    "add": {
                      "username": [
                        "${session.uid}"
                      ],
                      "mail": [
                        "${session.mail}"
                      ]
                    }
                  },
                  "capture": "all"
                }
              ],
              "handler": "ClientHandler"
            }
          }
        }
      ]
    }
  },
  "condition": "${matches(request.uri.path, '^/travelApp') or matches(request.uri.path, '^/saml')}",
  "session": "JwtSession"
}

